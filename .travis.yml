---
language: generic
stages:
  - test
  - name: deploy
    if: branch = master
jobs:
  include:
    - stage: test
      name: omnilint
      install: docker pull lpenz/omnilint
      script: docker run --rm -v "$PWD:$PWD" -e "RWD=$PWD" -e "MY_UID=$UID" lpenz/omnilint
    - name: build
      language: nix
      script: nix-build
    - stage: deploy
      name: deploy
      language: nix
      script: ./channel-build _output
      deploy:
        provider: pages
        skip-cleanup: true
        github-token: "$GITHUB_TOKEN"
        local_dir: _output
        target-branch: gh-pages
        on:
          branch: master
